<!DOCTYPE html>
<html>
<head>
    <title>Direct WebSocket Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Direct WebSocket Proxy Test</h1>
    <button onclick="testLocal()">Test Local</button>
    <button onclick="testProxy()">Test Proxy</button>
    <div id="status"></div>
    <pre id="log"></pre>
    
    <script>
        const log = (msg) => {
            const logEl = document.getElementById('log');
            logEl.textContent += msg + '\n';
            console.log(msg);
        };
        
        function testLocal() {
            log('Testing local WebSocket...');
            const ws = new WebSocket('ws://localhost:7880');
            
            ws.onopen = () => log('✅ Local WebSocket opened');
            ws.onerror = (e) => log('❌ Local WebSocket error: ' + e);
            ws.onclose = (e) => log('🔴 Local WebSocket closed: ' + e.code + ' ' + e.reason);
            ws.onmessage = (e) => log('📨 Local message: ' + e.data);
        }
        
        function testProxy() {
            const proxyUrl = window.location.protocol === 'https:' 
                ? 'wss://' + window.location.host + '/livekit-proxy'
                : 'ws://' + window.location.host + '/livekit-proxy';
                
            log('Testing proxy WebSocket: ' + proxyUrl);
            const ws = new WebSocket(proxyUrl);
            
            ws.onopen = () => log('✅ Proxy WebSocket opened');
            ws.onerror = (e) => log('❌ Proxy WebSocket error: ' + e);
            ws.onclose = (e) => log('🔴 Proxy WebSocket closed: ' + e.code + ' ' + e.reason);
            ws.onmessage = (e) => log('📨 Proxy message: ' + e.data);
        }
    </script>
</body>
</html>