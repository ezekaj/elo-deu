{% extends "base.html" %}

{% block title %}Ihre Termine - CRM{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #2c3e50;">📅 Ihre persönlichen Termine</h2>
        <a href="/" class="btn">🔄 Neue Suche</a>
    </div>

    <div class="alert alert-info">
        <strong>👤 Patient:</strong> {{ patient_name or telefon }}
        {% if telefon and patient_name %}
        <br><strong>📞 Telefon:</strong> {{ telefon }}
        {% endif %}
        <br><strong>📆 Zeitraum:</strong>
        {% if zeitraum == 'zukunft' %}🔮 Zukünftige Termine
        {% elif zeitraum == 'alle' %}📋 Alle Termine
        {% elif zeitraum == 'vergangen' %}📜 Vergangene Termine
        {% endif %}
    </div>

    {% if termine %}
        <div style="margin-bottom: 20px;">
            <strong>📊 Gefunden:</strong> {{ termine|length }} Termine
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 15px; text-align: left;">📅 Datum</th>
                        <th style="padding: 15px; text-align: left;">🕐 Uhrzeit</th>
                        <th style="padding: 15px; text-align: left;">🦷 Behandlung</th>
                        <th style="padding: 15px; text-align: left;">📋 Status</th>
                        <th style="padding: 15px; text-align: left;">🔍 Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for termin in termine %}
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 15px;">
                            <strong>{{ termin.datum }}</strong>
                            {% if termin.datum == heute.strftime('%Y-%m-%d') %}
                                <span style="background: #ffc107; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">HEUTE</span>
                            {% endif %}
                        </td>
                        <td style="padding: 15px;">{{ termin.uhrzeit }}</td>
                        <td style="padding: 15px;">{{ termin.behandlungsart }}</td>
                        <td style="padding: 15px;">
                            {% if termin.status == 'bestätigt' %}
                                <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px;">✅ Bestätigt</span>
                            {% elif termin.status == 'abgesagt' %}
                                <span style="background: #dc3545; color: white; padding: 4px 12px; border-radius: 4px;">❌ Abgesagt</span>
                            {% else %}
                                <span style="background: #ffc107; color: white; padding: 4px 12px; border-radius: 4px;">⏳ {{ termin.status }}</span>
                            {% endif %}
                        </td>
                        <td style="padding: 15px;">
                            <a href="/termin_details/{{ termin.id }}" class="btn" style="padding: 8px 15px; font-size: 14px;">
                                👁️ Ansehen
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    {% else %}
        <div class="alert alert-warning">
            <h3>😔 Keine Termine gefunden</h3>
            <p>Für <strong>{{ patient_name or telefon }}</strong> wurden keine Termine gefunden.</p>
            <div style="margin-top: 20px; text-align: center;">
                <a href="/" class="btn">🔄 Neue Suche starten</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #2c3e50;">📅 Ihre persönlichen Termine</h2>
        <a href="/" class="btn">🔄 Neue Suche</a>
    </div>
    
    <div class="alert alert-info">
        <strong>👤 Patient:</strong> {{ patient_name or telefon }}
        {% if telefon and patient_name %}
        <br><strong>📞 Telefon:</strong> {{ telefon }}
        {% endif %}
        <br><strong>📆 Zeitraum:</strong> 
        {% if zeitraum == 'zukunft' %}🔮 Zukünftige Termine
        {% elif zeitraum == 'alle' %}📋 Alle Termine
        {% elif zeitraum == 'vergangen' %}📜 Vergangene Termine
        {% endif %}
    </div>
    
    {% if termine %}
        <div style="margin-bottom: 20px;">
            <strong>📊 Gefunden:</strong> {{ termine|length }} Termine
        </div>
        
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">📅 Datum</th>
                        <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">🕐 Uhrzeit</th>
                        <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">🦷 Behandlung</th>
                        <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">📋 Status</th>
                        <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">🔍 Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for termin in termine %}
                    <tr style="border-bottom: 1px solid #dee2e6; {% if termin.datum < heute.strftime('%Y-%m-%d') %}background: #f8f9fa;{% elif termin.datum == heute.strftime('%Y-%m-%d') %}background: #fff3cd;{% endif %}">
                        <td style="padding: 15px;">
                            <strong>{{ termin.datum }}</strong>
                            {% if termin.datum == heute.strftime('%Y-%m-%d') %}
                                <span style="background: #ffc107; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">HEUTE</span>
                            {% elif termin.datum < heute.strftime('%Y-%m-%d') %}
                                <span style="background: #6c757d; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">VERGANGEN</span>
                            {% endif %}
                        </td>
                        <td style="padding: 15px;">{{ termin.uhrzeit }}</td>
                        <td style="padding: 15px;">{{ termin.behandlungsart }}</td>
                        <td style="padding: 15px;">
                            {% if termin.status == 'bestätigt' %}
                                <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px;">✅ Bestätigt</span>
                            {% elif termin.status == 'abgesagt' %}
                                <span style="background: #dc3545; color: white; padding: 4px 12px; border-radius: 4px;">❌ Abgesagt</span>
                            {% else %}
                                <span style="background: #ffc107; color: white; padding: 4px 12px; border-radius: 4px;">⏳ {{ termin.status }}</span>
                            {% endif %}
                        </td>
                        <td style="padding: 15px;">
                            <a href="/termin_details/{{ termin.id }}" class="btn" style="padding: 8px 15px; font-size: 14px;">
                                👁️ Ansehen
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="/?patient_name={{ patient_name }}&telefon={{ telefon }}&zeitraum=zukunft" class="btn">🔮 Zukünftige Termine</a>
            <a href="/?patient_name={{ patient_name }}&telefon={{ telefon }}&zeitraum=alle" class="btn">📋 Alle Termine</a>
            <a href="/?patient_name={{ patient_name }}&telefon={{ telefon }}&zeitraum=vergangen" class="btn">📜 Vergangene Termine</a>
        </div>
        
    {% else %}
        <div class="alert alert-warning">
            <h3>😔 Keine Termine gefunden</h3>
            <p>Für <strong>{{ patient_name or telefon }}</strong> wurden keine Termine im gewählten Zeitraum gefunden.</p>
            
            <div style="margin-top: 20px;">
                <strong>💡 Mögliche Gründe:</strong>
                <ul style="margin-top: 10px;">
                    <li>Sie sind unter einem anderen Namen registriert</li>
                    <li>Ihre Telefonnummer ist anders gespeichert</li>
                    <li>Sie haben noch keine Termine vereinbart</li>
                    <li>Der gewählte Zeitraum enthält keine Termine</li>
                </ul>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <a href="/" class="btn">🔄 Neue Suche starten</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
